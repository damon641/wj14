<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WhitePoker" />
    <title>White Poker</title>
    <link rel="icon" href="../img/favicon.ico" type="image/x-icon" />
    <link href="/dist/web/css/bootstrap.min.css" rel="stylesheet">

    <!--WPA manifest-->
    <link rel="manifest" href="/manifest.json">
    <!--Web Progressive App-->
    <meta name="theme-color" content="#2196f3" />
    <!--Web Progressive App for iOS-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="WhitePoker">
    <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png">


    <link rel="stylesheet" href="/dist/web/css/font-awesome.min.css">
    <link href="/dist/web/css/style.css" rel="stylesheet">
    <script type="text/javascript" src="/dist/web/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/dist/web/js/bootstrap.min.js"></script>
    <!-- <script type="text/javascript" src="/dist/web/js/socket.io.js"></script> -->
    <!-- <script src="/dist/js/install.js"></script> -->
</head>
<style type="text/css">
    .log_bg {
        background: #000;
    }
    
    .modal-content.custam_popup {
        width: 23%;
        margin: 167px auto;
    }
    
    @media (max-width: 991px) {
        .modal-content.custam_popup {
            width: 400px;
            margin: 167px auto;
        }
    }
    
    @media (max-width: 767px) {
        .modal-content.custam_popup {
            width: 300px;
            margin: 0 auto;
        }
    }
    
    .errModal {
        display: none;
        background: #0d3053 !important;
        color: #fff;
    }
    /* Chrome, Safari, Edge, Opera */
    
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    /* Firefox */
    
    input[type=number] {
        -moz-appearance: textfield;
    }
</style>

<body class="log_bg">

    <!-- Notification Panel For Browsers -->
    <!-- {% if (success.length > 0) %}
		<li><div class="alert alert-success alert-dismissable notifications web hidden">
			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>{{success}}
		</div></li>
		{% endif %}
		{% if (error.length > 0) %}
		<li><div class="alert alert-danger alert-dismissable notifications web hidden">
			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>{{error}}
		</div></li>
		{% endif %}
		<li><div class="web notificationsLogout hidden"></div></li> -->

    <!-- Notification Panel For Mobile Device -->
    <!-- {% if (success.length > 0) %}
		<div class="alert alert-success alert-dismissable notifications mobile hidden">
			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>{{success}}
		</div>
		{% endif %}
		{% if (error.length > 0) %}
		<div class="alert alert-danger alert-dismissable notifications mobile hidden">
			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>{{error}}
		</div>
		{% endif %}
		<div class="mobileChange notificationsLogout hidden"></div> -->

    <!-- Sign In / Sign Up Modal -->

    <div class="modal-content custam_popup">

        <!-- Start : Modal for showing error message -->
        <div class="modal-content errModal">
            <div class="modal-body">
                <h4 class="errModalHeader" align="center"></h4>
            </div>
        </div>
        <!-- End : Modal for showing error message -->

        <div class="modal-body login_reg">
            <div class="login_regis_sw">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="active signInLi">
                        <a href="#signin" role="tab" data-toggle="tab">Sign In</a>
                    </li>
                    <li class="signUpLi"><a href="#signup" role="tab" data-toggle="tab">Sign Up</a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div class="tab-pane fade active in" id="signin">
                        <form class="contact" action="/web/login" method="post">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Email/UserName</label>
                                        <input type="text" class="form-control" name="username" id="uname" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Password</label>
                                        <input type="password" class="form-control" name="password" id="pass" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="checkbox">
                                        <input id="checkbox1" class="styled" type="checkbox">
                                        <label for="checkbox1">
														Remember Me
													</label>
                                    </div>
                                </div>
                                <!-- <div class="col-lg-6 text-right">
												<div class="form-group">
													<a href="javascript:void(0);" class="forgt_link">Forgot Password</a>
												</div>
											</div> -->
                            </div>

                            <div class="row mt-1">
                                <div class="col-lg-6 col-lg-offset-3">
                                    <!-- <button type="button" class="btn btn-primary btn-block">Login</button> -->
                                    <input type="submit" id="login" class="btn btn-primary btn-block" value="Login">
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-lg-6 col-lg-offset-3 text-center">
                                    <div class="text-dark">Or</div>
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-lg-8 col-lg-offset-2">
                                    <button type="button" href="#signup" data-toggle="tab" class="btn btn-primary btn-block signup">Create New Account</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="signup">
                        <form class="contact" action="/web/register" method="post">
                            <!-- <div class="row">
											<div class="col-lg-12">
												<div class="form-group">
													<label>Name</label>
													<input type="text" name="name" required class="form-control">
												</div>
											</div>
										</div> -->
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Username</label>
                                        <input type="text" name="username" required class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" name="email" required class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Phone Number</label>
                                        <input type="text" name="mobile" id="mobile" required class="form-control" pattern=".{8,10}" title="mobile number must be 8 or 10 digits minimum" maxlength="10">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Password</label>
                                        <input type="password" id="password" name="password" required class="form-control" pattern=".{6,8}" title="password must be 6 or 8 characters minimum">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Confirm Password</label>
                                        <input type="password" id="confirm_password" name="confirm_password" required class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-1">
                                <div class="col-lg-6">
                                    <!-- <button type="button" class="btn btn-primary btn-block">Register</button> -->
                                    <input type="submit" class="btn btn-primary btn-block" value="Register">
                                </div>
                                <div class="col-lg-6">
                                    <a href="/webgl/"><button type="button" class="btn btn-primary btn-block">Cancel</button></a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- <div class="forg_pas">
							<form class="contact">
								<div class="row">
									<div class="col-lg-12">
										<div class="form-group">
											<label>Forgot Passwords</label>
											<input type="text" class="form-control">
										</div>
									</div>
								</div>
								<div class="row mt-1">
									<div class="col-lg-6">
										<button type="button" class="btn btn-primary btn-block">Send</button>
									</div>
									<div class="col-lg-6">
										<a href="/webgl/"><button type="button" class="btn btn-primary btn-block">Cancel</button></a>
									</div>
								</div>
							</form>
						</div> -->
        </div>

    </div>
    <!-- /.modal-content -->

    <!-- Sign In / Sign Up Modal -->

    <input type="hidden" id="playerId" value="{{session.id}}">
    <input type="hidden" id="loggedInToken" value="{{session.loggedInToken}}">
    <input type="hidden" id="allLoggedInTokens" value='{{allLoggedInTokens}}'>
    <input type="hidden" id="successIdTag" value='{{success}}'>
    <input type="hidden" id="sessionIdTag" value='{{session}}'>

    <script>
        $(".forgt_link").click(function() {
            $(".login_regis_sw").hide();
            $(".forg_pas").show();
        });

        $(".signup").click(function() {
            $(".signInLi").removeClass('active');
            $(".signUpLi").addClass('active');
        });


        // Restricts input for the given textbox to the given inputFilter.
        function setInputFilter(textbox, inputFilter) {
            ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function(event) {
                textbox.addEventListener(event, function() {
                    if (inputFilter(this.value)) {
                        this.oldValue = this.value;
                        this.oldSelectionStart = this.selectionStart;
                        this.oldSelectionEnd = this.selectionEnd;
                    } else if (this.hasOwnProperty("oldValue")) {
                        this.value = this.oldValue;
                        this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                    } else {
                        this.value = "";
                    }
                });
            });
        }

        setInputFilter(document.getElementById("mobile"), function(value) {
            console.log("VAL", value)
            return /^\d*$/.test(value);
        });
        /*setTimeout(function(){
        	$('.notifications').slideUp('slow');
        	var cells =  $('.notifications');
        	setTimeout(function(){
        		cells.remove();
        	},1000);
        },2000);*/

        /* Confirm Passwords */
        var password = document.getElementById("password"),
            confirm_password = document.getElementById("confirm_password");

        function validatePassword() {
            if (password.value != confirm_password.value) {
                confirm_password.setCustomValidity("Passwords Don't Match");
            } else {
                confirm_password.setCustomValidity('');
            }
        }
        password.onchange = validatePassword;
        confirm_password.onkeyup = validatePassword;
        /* Confirm Passwords */

        $(document).ready(function() {
            var host = "https://pokerscript.net";
            var allLoggedInTokens;
            var session;
            $.ajax({
                type: 'get',
                url: host + '/webLogin',
                success: function(res) {
                    console.log("res", res);
                    allLoggedInTokens = res.allLoggedInTokens;
                    session = res.session;

                    sessionIdTag = session;
                    console.log("sessionIdTag", sessionIdTag);
                    if (sessionIdTag) {
                        console.log("true");
                        redirectToWebGL();
                        /*setTimeout(function () {
                        	$('#login').click();
                        }, 1000);*/
                    }
                    if (res.error.length) {
                        $('.errModal').show();
                        $('.errModalHeader').text(res.error);
                        setTimeout(function() {
                            $('.errModal').fadeOut(2000);
                        }, 2000);
                    }
                }
            });

            $('#checkbox1').click(function() {
                if ($('#checkbox1').is(':checked')) {
                    let uname = $('#uname').val();
                    let password = $('#pass').val();
                    let checkbox = $('#checkbox1').is(':checked');
                    localStorage.setItem('username', uname);
                    localStorage.setItem('password', password);
                    localStorage.setItem('checkbox', checkbox);
                } else {
                    localStorage.clear();
                }
            });

            function rememberMe() {
                $('#uname').val(localStorage.getItem('username'));
                $('#pass').val(localStorage.getItem('password'));
                if (localStorage.length > 0) {
                    $('#checkbox1').attr("checked", "checked");
                }
            }
            rememberMe();

            // sessionIdTag = $('#sessionIdTag').val();
            // successIdTag = $('#successIdTag').val();
            // console.log("successIdTag", successIdTag);
            // console.log("sessionIdTag", sessionIdTag);
            // if(sessionIdTag && successIdTag){
            // 	console.log("true");
            // 	redirectToWebGL();
            // 	/*setTimeout(function () {
            // 		$('#login').click();
            // 	}, 1000);*/
            // }



            // WebGL redirection
            // $("#login").on("click", function () {
            function redirectToWebGL() {
                console.log("login clicked");
                var host = "https://pokerscript.net";
                //var host = window.location.origin;
                // var playerId = $("#playerId").val();
                var playerId = session.id;
                //var allLoggedInTokens = $('#allLoggedInTokens').val();
                // var loggedInToken = $("#loggedInToken").val();
                var loggedInToken = session.loggedInToken;
                allLoggedInTokens = JSON.parse(allLoggedInTokens);
                let logIn = null;
                $.each(allLoggedInTokens, function(i, value) {
                    if (loggedInToken == value.loginToken) {
                        logIn = value.loginToken;
                    }
                });
                if (logIn) {
                    console.log("logIn", logIn);
                    if (playerId != "") {
                        console.log("playerId", playerId);
                        let randomvalue = randomString(36);
                        $.ajax({
                            type: 'post',
                            url: host + "/identifiertoken",
                            data: {
                                id: playerId,
                                identifiertoken: randomvalue
                            },
                            success: function(r) {
                                if (r == 'success') {
                                    var url = host + "/WPA/index.html?token=" + randomvalue + "&u=" + playerId;
                                    window.open(url, '_self');
                                } else {
                                    console.log("r", r);
                                }
                            },
                            error: function(jqXHR, exeption) {
                                console.log("exeption", exeption);
                            }
                        });
                    }
                } else {
                    setTimeout(function() {
                        var cells = $('.notificationsLogout');
                        if (cells.hasClass('mobileChange')) {
                            cells.addClass('mobile');
                        }
                        cells.addClass('alert alert-danger alert-dismissable');
                        cells.text('New Login Has Made.');
                        setTimeout(function() {
                            cells.remove();
                            window.location.href = '/web/logout';
                        }, 2000);
                    }, 500);
                }
            };

            function randomString(length) {
                var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
                var result = '';
                for (var i = length; i > 0; --i) {
                    result += chars[Math.floor(Math.random() * chars.length)];
                }
                return result;
            }

        });


        if ('serviceWorker' in navigator) {
            try {
                navigator.serviceWorker.register('/service-worker.js');
                console.log("SW registered");
            } catch (error) {
                console.log("SW register fail");
            }
        }
    </script>
</body>

</html>